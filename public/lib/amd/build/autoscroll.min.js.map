{"version":3,"file":"autoscroll.min.js","sources":["../src/autoscroll.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * JavaScript to provide automatic scrolling, e.g. during a drag operation.\r\n *\r\n * Note: this module is defined statically. It is a singleton. You\r\n * can only have one use of it active at any time. However, since this\r\n * is usually used in relation to drag-drop, and since you only ever\r\n * drag one thing at a time, this is not a problem in practice.\r\n *\r\n * @module     core/autoscroll\r\n * @copyright  2016 The Open University\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.6\r\n */\r\ndefine(['jquery'], function($) {\r\n    /**\r\n     * @alias module:core/autoscroll\r\n     */\r\n    var autoscroll = {\r\n        /**\r\n         * Size of area near edge of screen that triggers scrolling.\r\n         * @private\r\n         */\r\n        SCROLL_THRESHOLD: 30,\r\n\r\n        /**\r\n         * How frequently to scroll window.\r\n         * @private\r\n         */\r\n        SCROLL_FREQUENCY: 1000 / 60,\r\n\r\n        /**\r\n         * How many pixels to scroll per unit (1 = max scroll 30).\r\n         * @private\r\n         */\r\n        SCROLL_SPEED: 0.5,\r\n\r\n        /**\r\n         * Set if currently scrolling up/down.\r\n         * @private\r\n         */\r\n        scrollingId: null,\r\n\r\n        /**\r\n         * Speed we are supposed to scroll (range 1 to SCROLL_THRESHOLD).\r\n         * @private\r\n         */\r\n        scrollAmount: 0,\r\n\r\n        /**\r\n         * Optional callback called when it scrolls\r\n         * @private\r\n         */\r\n        callback: null,\r\n\r\n        /**\r\n         * Starts automatically scrolling if user moves near edge of window.\r\n         * This should be called in response to mouse down or touch start.\r\n         *\r\n         * @public\r\n         * @param {Function} callback Optional callback that is called every time it scrolls\r\n         */\r\n        start: function(callback) {\r\n            $(window).on('mousemove', autoscroll.mouseMove);\r\n            $(window).on('touchmove', autoscroll.touchMove);\r\n            autoscroll.callback = callback;\r\n        },\r\n\r\n        /**\r\n         * Stops automatically scrolling. This should be called in response to mouse up or touch end.\r\n         *\r\n         * @public\r\n         */\r\n        stop: function() {\r\n            $(window).off('mousemove', autoscroll.mouseMove);\r\n            $(window).off('touchmove', autoscroll.touchMove);\r\n            if (autoscroll.scrollingId !== null) {\r\n                autoscroll.stopScrolling();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Event handler for touch move.\r\n         *\r\n         * @private\r\n         * @param {Object} e Event\r\n         */\r\n        touchMove: function(e) {\r\n            for (var i = 0; i < e.changedTouches.length; i++) {\r\n                autoscroll.handleMove(e.changedTouches[i].clientX, e.changedTouches[i].clientY);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Event handler for mouse move.\r\n         *\r\n         * @private\r\n         * @param {Object} e Event\r\n         */\r\n        mouseMove: function(e) {\r\n            autoscroll.handleMove(e.clientX, e.clientY);\r\n        },\r\n\r\n        /**\r\n         * Handles user moving.\r\n         *\r\n         * @private\r\n         * @param {number} clientX X\r\n         * @param {number} clientY Y\r\n         */\r\n        handleMove: function(clientX, clientY) {\r\n            // If near the bottom or top, start auto-scrolling.\r\n            if (clientY < autoscroll.SCROLL_THRESHOLD) {\r\n                autoscroll.scrollAmount = -Math.min(autoscroll.SCROLL_THRESHOLD - clientY, autoscroll.SCROLL_THRESHOLD);\r\n            } else if (clientY > $(window).height() - autoscroll.SCROLL_THRESHOLD) {\r\n                autoscroll.scrollAmount = Math.min(clientY - ($(window).height() - autoscroll.SCROLL_THRESHOLD),\r\n                    autoscroll.SCROLL_THRESHOLD);\r\n            } else {\r\n                autoscroll.scrollAmount = 0;\r\n            }\r\n            if (autoscroll.scrollAmount && autoscroll.scrollingId === null) {\r\n                autoscroll.startScrolling();\r\n            } else if (!autoscroll.scrollAmount && autoscroll.scrollingId !== null) {\r\n                autoscroll.stopScrolling();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Starts automatic scrolling.\r\n         *\r\n         * @private\r\n         */\r\n        startScrolling: function() {\r\n            var maxScroll = $(document).height() - $(window).height();\r\n            autoscroll.scrollingId = window.setInterval(function() {\r\n                // Work out how much to scroll.\r\n                var y = $(window).scrollTop();\r\n                var offset = Math.round(autoscroll.scrollAmount * autoscroll.SCROLL_SPEED);\r\n                if (y + offset < 0) {\r\n                    offset = -y;\r\n                }\r\n                if (y + offset > maxScroll) {\r\n                    offset = maxScroll - y;\r\n                }\r\n                if (offset === 0) {\r\n                    return;\r\n                }\r\n\r\n                // Scroll.\r\n                $(window).scrollTop(y + offset);\r\n                var realOffset = $(window).scrollTop() - y;\r\n                if (realOffset === 0) {\r\n                    return;\r\n                }\r\n\r\n                // Inform callback\r\n                if (autoscroll.callback) {\r\n                    autoscroll.callback(realOffset);\r\n                }\r\n\r\n            }, autoscroll.SCROLL_FREQUENCY);\r\n        },\r\n\r\n        /**\r\n         * Stops the automatic scrolling.\r\n         *\r\n         * @private\r\n         */\r\n        stopScrolling: function() {\r\n            window.clearInterval(autoscroll.scrollingId);\r\n            autoscroll.scrollingId = null;\r\n        }\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * Starts automatic scrolling if user moves near edge of window.\r\n         * This should be called in response to mouse down or touch start.\r\n         *\r\n         * @public\r\n         * @param {Function} callback Optional callback that is called every time it scrolls\r\n         */\r\n        start: autoscroll.start,\r\n\r\n        /**\r\n         * Stops automatic scrolling. This should be called in response to mouse up or touch end.\r\n         *\r\n         * @public\r\n         */\r\n        stop: autoscroll.stop\r\n    };\r\n\r\n});\r\n"],"names":["define","$","autoscroll","SCROLL_THRESHOLD","SCROLL_FREQUENCY","SCROLL_SPEED","scrollingId","scrollAmount","callback","start","window","on","mouseMove","touchMove","stop","off","stopScrolling","e","i","changedTouches","length","handleMove","clientX","clientY","Math","min","height","startScrolling","maxScroll","document","setInterval","y","scrollTop","offset","round","realOffset","clearInterval"],"mappings":";;;;;;;;;;;;;AA4BAA,yBAAO,CAAC,WAAW,SAASC,OAIpBC,WAAa,CAKbC,iBAAkB,GAMlBC,iBAAkB,IAAO,GAMzBC,aAAc,GAMdC,YAAa,KAMbC,aAAc,EAMdC,SAAU,KASVC,MAAO,SAASD,UACZP,EAAES,QAAQC,GAAG,YAAaT,WAAWU,WACrCX,EAAES,QAAQC,GAAG,YAAaT,WAAWW,WACrCX,WAAWM,SAAWA,UAQ1BM,KAAM,WACFb,EAAES,QAAQK,IAAI,YAAab,WAAWU,WACtCX,EAAES,QAAQK,IAAI,YAAab,WAAWW,WACP,OAA3BX,WAAWI,aACXJ,WAAWc,iBAUnBH,UAAW,SAASI,OACX,IAAIC,EAAI,EAAGA,EAAID,EAAEE,eAAeC,OAAQF,IACzChB,WAAWmB,WAAWJ,EAAEE,eAAeD,GAAGI,QAASL,EAAEE,eAAeD,GAAGK,UAU/EX,UAAW,SAASK,GAChBf,WAAWmB,WAAWJ,EAAEK,QAASL,EAAEM,UAUvCF,WAAY,SAASC,QAASC,SAEtBA,QAAUrB,WAAWC,iBACrBD,WAAWK,cAAgBiB,KAAKC,IAAIvB,WAAWC,iBAAmBoB,QAASrB,WAAWC,kBAC/EoB,QAAUtB,EAAES,QAAQgB,SAAWxB,WAAWC,iBACjDD,WAAWK,aAAeiB,KAAKC,IAAIF,SAAWtB,EAAES,QAAQgB,SAAWxB,WAAWC,kBAC1ED,WAAWC,kBAEfD,WAAWK,aAAe,EAE1BL,WAAWK,cAA2C,OAA3BL,WAAWI,YACtCJ,WAAWyB,iBACHzB,WAAWK,cAA2C,OAA3BL,WAAWI,aAC9CJ,WAAWc,iBASnBW,eAAgB,eACRC,UAAY3B,EAAE4B,UAAUH,SAAWzB,EAAES,QAAQgB,SACjDxB,WAAWI,YAAcI,OAAOoB,aAAY,eAEpCC,EAAI9B,EAAES,QAAQsB,YACdC,OAAST,KAAKU,MAAMhC,WAAWK,aAAeL,WAAWG,iBACzD0B,EAAIE,OAAS,IACbA,QAAUF,GAEVA,EAAIE,OAASL,YACbK,OAASL,UAAYG,GAEV,IAAXE,QAKJhC,EAAES,QAAQsB,UAAUD,EAAIE,YACpBE,WAAalC,EAAES,QAAQsB,YAAcD,EACtB,IAAfI,YAKAjC,WAAWM,UACXN,WAAWM,SAAS2B,eAGzBjC,WAAWE,mBAQlBY,cAAe,WACXN,OAAO0B,cAAclC,WAAWI,aAChCJ,WAAWI,YAAc,aAI1B,CAQHG,MAAOP,WAAWO,MAOlBK,KAAMZ,WAAWY"}