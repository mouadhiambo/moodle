{"version":3,"file":"showhidesettings.min.js","sources":["../src/showhidesettings.js"],"sourcesContent":["/**\r\n * Show/hide admin settings based on other settings selected\r\n *\r\n * @copyright 2018 Davo Smith, Synergy Learning\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery'], function($) {\r\n    var dependencies;\r\n\r\n    // -------------------------------------------------\r\n    // Support functions, used by dependency functions.\r\n    // -------------------------------------------------\r\n\r\n    /**\r\n     * Check to see if the given element is the hidden element that makes sure checkbox\r\n     * elements always submit a value.\r\n     * @param {jQuery} $el\r\n     * @returns {boolean}\r\n     */\r\n    function isCheckboxHiddenElement($el) {\r\n        return ($el.is('input[type=hidden]') && $el.siblings('input[type=checkbox][name=\"' + $el.attr('name') + '\"]').length);\r\n    }\r\n\r\n    /**\r\n     * Check to see if this is a radio button with the wrong value (i.e. a radio button from\r\n     * the group we are interested in, but not the specific one we wanted).\r\n     * @param {jQuery} $el\r\n     * @param {string} value\r\n     * @returns {boolean}\r\n     */\r\n    function isWrongRadioButton($el, value) {\r\n        return ($el.is('input[type=radio]') && $el.attr('value') !== value);\r\n    }\r\n\r\n    /**\r\n     * Is this element relevant when we're looking for checked / not checked status?\r\n     * @param {jQuery} $el\r\n     * @param {string} value\r\n     * @returns {boolean}\r\n     */\r\n    function isCheckedRelevant($el, value) {\r\n        return (!isCheckboxHiddenElement($el) && !isWrongRadioButton($el, value));\r\n    }\r\n\r\n    /**\r\n     * Is this an unchecked radio button? (If it is, we want to skip it, as\r\n     * we're only interested in the value of the radio button that is checked)\r\n     * @param {jQuery} $el\r\n     * @returns {boolean}\r\n     */\r\n    function isUncheckedRadioButton($el) {\r\n        return ($el.is('input[type=radio]') && !$el.prop('checked'));\r\n    }\r\n\r\n    /**\r\n     * Is this an unchecked checkbox?\r\n     * @param {jQuery} $el\r\n     * @returns {boolean}\r\n     */\r\n    function isUncheckedCheckbox($el) {\r\n        return ($el.is('input[type=checkbox]') && !$el.prop('checked'));\r\n    }\r\n\r\n    /**\r\n     * Is this a multi-select select element?\r\n     * @param {jQuery} $el\r\n     * @returns {boolean}\r\n     */\r\n    function isMultiSelect($el) {\r\n        return ($el.is('select') && $el.prop('multiple'));\r\n    }\r\n\r\n    /**\r\n     * Are the selected values of a multi-select a subset of (i.e. 'in') the list of values provided?\r\n     * @param {jQuery} $el\r\n     * @param {array} values\r\n     * @returns {boolean}\r\n     */\r\n    function multiSelectIn($el, values) {\r\n        let selected = $el.val() || [];\r\n        if (selected.length == 0) {\r\n            selected.push('');\r\n        }\r\n\r\n        // Lock/hide if the selected values are a subset of the values.\r\n        let isSubset = selected.every(element => values.includes(element));\r\n        return isSubset;\r\n    }\r\n\r\n    /**\r\n     * Are the selected values of a multi-select an exact match (i.e. 'eq') to the list of values provided?\r\n     * @param {jQuery} $el\r\n     * @param {array} values\r\n     * @returns {boolean}\r\n     */\r\n    function multiSelectMatches($el, values) {\r\n        var selected = $el.val() || [];\r\n        if (values.length === 1 && values[0] === '') {\r\n            // Values array contains a single empty entry -> value was empty.\r\n            return selected.length === 0;\r\n        }\r\n        if (selected.length !== values.length) {\r\n            // Different number of expected and actual values - cannot possibly be a match.\r\n            return false;\r\n        }\r\n        for (var i in selected) {\r\n            if (selected.hasOwnProperty(i)) {\r\n                if (values.indexOf(selected[i]) === -1) {\r\n                    return false; // Found a non-matching value - give up immediately.\r\n                }\r\n            }\r\n        }\r\n        // Didn't find a non-matching value, so we have a match.\r\n        return true;\r\n    }\r\n\r\n    // -------------------------------\r\n    // Specific dependency functions.\r\n    // -------------------------------\r\n\r\n    var depFns = {\r\n        notchecked: function($dependon, value) {\r\n            var hide = false;\r\n            value = String(value);\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                if (isCheckedRelevant($el, value)) {\r\n                    hide = hide || !$el.prop('checked');\r\n                }\r\n            });\r\n            return hide;\r\n        },\r\n\r\n        checked: function($dependon, value) {\r\n            var hide = false;\r\n            value = String(value);\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                if (isCheckedRelevant($el, value)) {\r\n                    hide = hide || $el.prop('checked');\r\n                }\r\n            });\r\n            return hide;\r\n        },\r\n\r\n        noitemselected: function($dependon) {\r\n            var hide = false;\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                hide = hide || ($el.prop('selectedIndex') === -1);\r\n            });\r\n            return hide;\r\n        },\r\n\r\n        eq: function($dependon, value) {\r\n            var hide = false;\r\n            var hiddenVal = false;\r\n            value = String(value);\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                if (isUncheckedRadioButton($el)) {\r\n                    // For radio buttons, we're only interested in the one that is checked.\r\n                    return;\r\n                }\r\n                if (isCheckboxHiddenElement($el)) {\r\n                    // This is the hidden input that is part of the checkbox setting.\r\n                    // We will use this value, if the associated checkbox is unchecked.\r\n                    hiddenVal = ($el.val() === value);\r\n                    return;\r\n                }\r\n                if (isUncheckedCheckbox($el)) {\r\n                    // Checkbox is not checked - hide depends on the 'unchecked' value stored in\r\n                    // the associated hidden element, which we have already found, above.\r\n                    hide = hide || hiddenVal;\r\n                    return;\r\n                }\r\n                if (isMultiSelect($el)) {\r\n                    // Expect a list of values to match, separated by '|' - all of them must\r\n                    // match the values selected.\r\n                    var values = value.split('|');\r\n                    hide = multiSelectMatches($el, values);\r\n                    return;\r\n                }\r\n                // All other element types - just compare the value directly.\r\n                hide = hide || ($el.val() === value);\r\n            });\r\n            return hide;\r\n        },\r\n\r\n        'in': function($dependon, value) {\r\n            var hide = false;\r\n            var hiddenVal = false;\r\n            var values = value.split('|');\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                if (isUncheckedRadioButton($el)) {\r\n                    // For radio buttons, we're only interested in the one that is checked.\r\n                    return;\r\n                }\r\n                if (isCheckboxHiddenElement($el)) {\r\n                    // This is the hidden input that is part of the checkbox setting.\r\n                    // We will use this value, if the associated checkbox is unchecked.\r\n                    hiddenVal = (values.indexOf($el.val()) > -1);\r\n                    return;\r\n                }\r\n                if (isUncheckedCheckbox($el)) {\r\n                    // Checkbox is not checked - hide depends on the 'unchecked' value stored in\r\n                    // the associated hidden element, which we have already found, above.\r\n                    hide = hide || hiddenVal;\r\n                    return;\r\n                }\r\n                if (isMultiSelect($el)) {\r\n                    // For multiselect, we check to see if the selected values are a subset of the list of values provided.\r\n                    hide = multiSelectIn($el, values);\r\n                    return;\r\n                }\r\n                // All other element types - check to see if the value is in the list.\r\n                hide = hide || (values.indexOf($el.val()) > -1);\r\n            });\r\n            return hide;\r\n        },\r\n\r\n        defaultCondition: function($dependon, value) { // Not equal.\r\n            var hide = false;\r\n            var hiddenVal = false;\r\n            value = String(value);\r\n            $dependon.each(function(idx, el) {\r\n                var $el = $(el);\r\n                if (isUncheckedRadioButton($el)) {\r\n                    // For radio buttons, we're only interested in the one that is checked.\r\n                    return;\r\n                }\r\n                if (isCheckboxHiddenElement($el)) {\r\n                    // This is the hidden input that is part of the checkbox setting.\r\n                    // We will use this value, if the associated checkbox is unchecked.\r\n                    hiddenVal = ($el.val() !== value);\r\n                    return;\r\n                }\r\n                if (isUncheckedCheckbox($el)) {\r\n                    // Checkbox is not checked - hide depends on the 'unchecked' value stored in\r\n                    // the associated hidden element, which we have already found, above.\r\n                    hide = hide || hiddenVal;\r\n                    return;\r\n                }\r\n                if (isMultiSelect($el)) {\r\n                    // Expect a list of values to match, separated by '|' - all of them must\r\n                    // match the values selected to *not* hide the element.\r\n                    var values = value.split('|');\r\n                    hide = !multiSelectMatches($el, values);\r\n                    return;\r\n                }\r\n                // All other element types - just compare the value directly.\r\n                hide = hide || ($el.val() !== value);\r\n            });\r\n            return hide;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Find the element with the given name\r\n     * @param {String} name\r\n     * @returns {*|jQuery|HTMLElement}\r\n     */\r\n    function getElementsByName(name) {\r\n        // For the array elements, we use [name^=\"something[\"] to find the elements that their name begins with 'something['/\r\n        // This is to find both name = 'something[]' and name='something[index]'.\r\n        return $('[name=\"' + name + '\"],[name^=\"' + name + '[\"]');\r\n    }\r\n\r\n    /**\r\n     * Check to see whether a particular condition is met\r\n     * @param {*|jQuery|HTMLElement} $dependon\r\n     * @param {String} condition\r\n     * @param {mixed} value\r\n     * @returns {Boolean}\r\n     */\r\n    function checkDependency($dependon, condition, value) {\r\n        if (typeof depFns[condition] === \"function\") {\r\n            return depFns[condition]($dependon, value);\r\n        }\r\n        return depFns.defaultCondition($dependon, value);\r\n    }\r\n\r\n    /**\r\n     * Show / hide the elements that depend on some elements.\r\n     */\r\n    function updateDependencies() {\r\n        // Process all dependency conditions.\r\n        var toHide = {};\r\n        $.each(dependencies, function(dependonname) {\r\n            var dependon = getElementsByName(dependonname);\r\n            $.each(dependencies[dependonname], function(condition, values) {\r\n                $.each(values, function(value, elements) {\r\n                    var hide = checkDependency(dependon, condition, value);\r\n                    $.each(elements, function(idx, elToHide) {\r\n                        if (toHide.hasOwnProperty(elToHide)) {\r\n                            toHide[elToHide] = toHide[elToHide] || hide;\r\n                        } else {\r\n                            toHide[elToHide] = hide;\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        });\r\n\r\n        // Update the hidden status of all relevant elements.\r\n        $.each(toHide, function(elToHide, hide) {\r\n            getElementsByName(elToHide).each(function(idx, el) {\r\n                var $parent = $(el).closest('.form-item');\r\n                if ($parent.length) {\r\n                    if (hide) {\r\n                        $parent.hide();\r\n                    } else {\r\n                        $parent.show();\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initialise the event handlers.\r\n     */\r\n    function initHandlers() {\r\n        $.each(dependencies, function(depname) {\r\n            var $el = getElementsByName(depname);\r\n            if ($el.length) {\r\n                $el.on('change', updateDependencies);\r\n            }\r\n        });\r\n        updateDependencies();\r\n    }\r\n\r\n    /**\r\n     * Hide the 'this setting may be hidden' messages.\r\n     */\r\n    function hideDependencyInfo() {\r\n        $('.form-dependenton').hide();\r\n    }\r\n\r\n    return {\r\n        init: function(opts) {\r\n            dependencies = opts.dependencies;\r\n            initHandlers();\r\n            hideDependencyInfo();\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","dependencies","isCheckboxHiddenElement","$el","is","siblings","attr","length","isCheckedRelevant","value","isWrongRadioButton","isUncheckedRadioButton","prop","isUncheckedCheckbox","isMultiSelect","multiSelectMatches","values","selected","val","i","hasOwnProperty","indexOf","depFns","notchecked","$dependon","hide","String","each","idx","el","checked","noitemselected","eq","hiddenVal","split","push","every","element","includes","multiSelectIn","defaultCondition","getElementsByName","name","updateDependencies","toHide","dependonname","dependon","condition","elements","checkDependency","elToHide","$parent","closest","show","init","opts","depname","on"],"mappings":"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"}