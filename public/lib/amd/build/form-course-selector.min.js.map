{"version":3,"file":"form-course-selector.min.js","sources":["../src/form-course-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Course selector adaptor for auto-complete form element.\r\n *\r\n * @module     core/form-course-selector\r\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.1\r\n */\r\ndefine(['core/ajax', 'jquery'], function(ajax, $) {\r\n\r\n    return {\r\n        // Public variables and functions.\r\n        processResults: function(selector, data) {\r\n            // Mangle the results into an array of objects.\r\n            var results = [];\r\n            var i = 0;\r\n            var excludelist = String($(selector).data('exclude')).split(',');\r\n\r\n            for (i = 0; i < data.courses.length; i++) {\r\n                if (excludelist.indexOf(String(data.courses[i].id)) === -1) {\r\n                    results.push({value: data.courses[i].id, label: data.courses[i].displayname});\r\n                }\r\n            }\r\n            return results;\r\n        },\r\n\r\n        transport: function(selector, query, success, failure) {\r\n            var el = $(selector);\r\n\r\n            // Parse some data-attributes from the form element.\r\n            var requiredcapabilities = el.data('requiredcapabilities');\r\n            if (requiredcapabilities.trim() !== \"\") {\r\n                requiredcapabilities = requiredcapabilities.split(',');\r\n            } else {\r\n                requiredcapabilities = [];\r\n            }\r\n\r\n            var limittoenrolled = el.data('limittoenrolled');\r\n            var includefrontpage = el.data('includefrontpage');\r\n            var onlywithcompletion = el.data('onlywithcompletion');\r\n\r\n            // Build the query.\r\n            var promises = null;\r\n\r\n            if (typeof query === \"undefined\") {\r\n                query = '';\r\n            }\r\n\r\n            var searchargs = {\r\n                criterianame: 'search',\r\n                criteriavalue: query,\r\n                page: 0,\r\n                perpage: 100,\r\n                requiredcapabilities: requiredcapabilities,\r\n                limittoenrolled: limittoenrolled,\r\n                onlywithcompletion: onlywithcompletion\r\n            };\r\n\r\n            var calls = [{\r\n                methodname: 'core_course_search_courses', args: searchargs\r\n            }];\r\n            if (includefrontpage) {\r\n                calls.push({\r\n                    methodname: 'core_course_get_courses',\r\n                    args: {\r\n                        options: {\r\n                            ids: [includefrontpage]\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Go go go!\r\n            promises = ajax.call(calls);\r\n            $.when.apply($.when, promises).done(function(data, site) {\r\n                if (site && site.length == 1) {\r\n                    var frontpage = site.pop();\r\n                    var matches = query === ''\r\n                        || frontpage.fullname.toUpperCase().indexOf(query.toUpperCase()) > -1\r\n                        || frontpage.shortname.toUpperCase().indexOf(query.toUpperCase()) > -1;\r\n                    if (matches) {\r\n                        data.courses.splice(0, 0, frontpage);\r\n                    }\r\n                }\r\n                success(data);\r\n            }).fail(failure);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","ajax","$","processResults","selector","data","results","i","excludelist","String","split","courses","length","indexOf","id","push","value","label","displayname","transport","query","success","failure","el","requiredcapabilities","trim","promises","limittoenrolled","includefrontpage","onlywithcompletion","calls","methodname","args","criterianame","criteriavalue","page","perpage","options","ids","call","when","apply","done","site","frontpage","pop","fullname","toUpperCase","shortname","splice","fail"],"mappings":";;;;;;;;AAuBAA,mCAAO,CAAC,YAAa,WAAW,SAASC,KAAMC,SAEpC,CAEHC,eAAgB,SAASC,SAAUC,UAE3BC,QAAU,GACVC,EAAI,EACJC,YAAcC,OAAOP,EAAEE,UAAUC,KAAK,YAAYK,MAAM,SAEvDH,EAAI,EAAGA,EAAIF,KAAKM,QAAQC,OAAQL,KACwB,IAArDC,YAAYK,QAAQJ,OAAOJ,KAAKM,QAAQJ,GAAGO,MAC3CR,QAAQS,KAAK,CAACC,MAAOX,KAAKM,QAAQJ,GAAGO,GAAIG,MAAOZ,KAAKM,QAAQJ,GAAGW,qBAGjEZ,SAGXa,UAAW,SAASf,SAAUgB,MAAOC,QAASC,aACtCC,GAAKrB,EAAEE,UAGPoB,qBAAuBD,GAAGlB,KAAK,wBAE/BmB,qBADgC,KAAhCA,qBAAqBC,OACED,qBAAqBd,MAAM,KAE3B,OAQvBgB,SALAC,gBAAkBJ,GAAGlB,KAAK,mBAC1BuB,iBAAmBL,GAAGlB,KAAK,oBAC3BwB,mBAAqBN,GAAGlB,KAAK,2BAKZ,IAAVe,QACPA,MAAQ,QAaRU,MAAQ,CAAC,CACTC,WAAY,6BAA8BC,KAX7B,CACbC,aAAc,SACdC,cAAed,MACfe,KAAM,EACNC,QAAS,IACTZ,qBAAsBA,qBACtBG,gBAAiBA,gBACjBE,mBAAoBA,sBAMpBD,kBACAE,MAAMf,KAAK,CACPgB,WAAY,0BACZC,KAAM,CACFK,QAAS,CACLC,IAAK,CAACV,sBAOtBF,SAAWzB,KAAKsC,KAAKT,OACrB5B,EAAEsC,KAAKC,MAAMvC,EAAEsC,KAAMd,UAAUgB,MAAK,SAASrC,KAAMsC,SAC3CA,MAAuB,GAAfA,KAAK/B,OAAa,KACtBgC,UAAYD,KAAKE,OACG,KAAVzB,OACPwB,UAAUE,SAASC,cAAclC,QAAQO,MAAM2B,gBAAkB,GACjEH,UAAUI,UAAUD,cAAclC,QAAQO,MAAM2B,gBAAkB,IAErE1C,KAAKM,QAAQsC,OAAO,EAAG,EAAGL,WAGlCvB,QAAQhB,SACT6C,KAAK5B"}