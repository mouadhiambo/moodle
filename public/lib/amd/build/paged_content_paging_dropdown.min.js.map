{"version":3,"file":"paged_content_paging_dropdown.min.js","sources":["../src/paged_content_paging_dropdown.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to manage the paging dropdown control.\r\n *\r\n * @module     core/paged_content_paging_dropdown\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'core/custom_interaction_events',\r\n        'core/paged_content_events',\r\n        'core/pubsub'\r\n    ],\r\n    function(\r\n        $,\r\n        CustomEvents,\r\n        PagedContentEvents,\r\n        PubSub\r\n    ) {\r\n\r\n    var SELECTORS = {\r\n        ROOT: '[data-region=\"paging-dropdown-container\"]',\r\n        DROPDOWN_ITEM: '[data-region=\"dropdown-item\"]',\r\n        DROPDOWN_TOGGLE: '[data-region=\"dropdown-toggle\"]',\r\n        ACTIVE_DROPDOWN_ITEM: '[data-region=\"dropdown-item\"].active',\r\n        CARET: '[data-region=\"caret\"]'\r\n    };\r\n\r\n    /**\r\n     * Get the page number.\r\n     *\r\n     * @param {jquery} item The dropdown item.\r\n     * @returns {Number}\r\n     */\r\n    var getPageNumber = function(item) {\r\n        return parseInt(item.attr('data-page-number'), 10);\r\n    };\r\n\r\n    /**\r\n     * Get all paging dropdown items.\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @returns {jquery} A jquery object with all items.\r\n     */\r\n    var getAllItems = function(root) {\r\n        return root.find(SELECTORS.DROPDOWN_ITEM);\r\n    };\r\n\r\n    /**\r\n     * Get all paging dropdown items with lower page numbers than the given\r\n     * dropdown item.\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @param {jquery} item The dropdown item.\r\n     * @returns {jquery} A jquery object with all items.\r\n     */\r\n    var getPreviousItems = function(root, item) {\r\n        var pageNumber = getPageNumber(item);\r\n        return getAllItems(root).filter(function(index, element) {\r\n            return getPageNumber($(element)) < pageNumber;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Get the number of items to be loaded for the dropdown item.\r\n     *\r\n     * @param {jquery} item The dropdown item.\r\n     * @returns {Number}\r\n     */\r\n    var getLimit = function(item) {\r\n        return parseInt(item.attr('data-item-count'), 10);\r\n    };\r\n\r\n    /**\r\n     * Get the offset of items from the start of the itemset for the given\r\n     * dropdown item.\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @param {jquery} item The dropdown item.\r\n     * @returns {Number}\r\n     */\r\n    var getOffset = function(root, item) {\r\n        if (item.attr('data-offset') != undefined) {\r\n            return parseInt(item.attr('data-offset'), 10);\r\n        }\r\n\r\n        var offset = 0;\r\n\r\n        getPreviousItems(root, item).each(function(index, prevItem) {\r\n            prevItem = $(prevItem);\r\n            offset += getLimit(prevItem);\r\n        });\r\n\r\n        item.attr('data-offset', offset);\r\n        return offset;\r\n    };\r\n\r\n    /**\r\n     * Get the active dropdown item.\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @returns {jquery} The active dropdown item.\r\n     */\r\n    var getActiveItem = function(root) {\r\n        return root.find(SELECTORS.ACTIVE_DROPDOWN_ITEM);\r\n    };\r\n\r\n    /**\r\n     * Create the event payload for the list of dropdown items. The event payload\r\n     * is an array of objects with one object per dropdown item.\r\n     *\r\n     * Each payload object contains the page number, limit, and offset for the\r\n     * corresponding dropdown item.\r\n     *\r\n     * For example: If we had 3 dropdown items with incrementing page numbers loading\r\n     * 25 items per page then the generated payload would look like:\r\n     * [\r\n     *      {\r\n     *          pageNumber: 1,\r\n     *          limit: 25,\r\n     *          offset: 0\r\n     *      },\r\n     *      {\r\n     *          pageNumber: 2,\r\n     *          limit: 25,\r\n     *          offset: 25\r\n     *      },\r\n     *      {\r\n     *          pageNumber: 3,\r\n     *          limit: 25,\r\n     *          offset: 50\r\n     *      }\r\n     * ]\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @param {jquery} items The dropdown items.\r\n     * @returns {object[]} The payload for the event.\r\n     */\r\n    var generateEventPayload = function(root, items) {\r\n        return items.map(function(index, item) {\r\n            item = $(item);\r\n            return {\r\n                pageNumber: getPageNumber(item),\r\n                limit: getLimit(item),\r\n                offset: getOffset(root, item),\r\n            };\r\n        }).get();\r\n    };\r\n\r\n    /**\r\n     * Add page number attributes to each of the given items. The page numbers\r\n     * start at 1 and increment by 1 for each item, e.g. 1, 2, 3 etc.\r\n     *\r\n     * @param {jquery} items The dropdown items.\r\n     */\r\n    var generatePageNumbers = function(items) {\r\n        items.each(function(index, item) {\r\n            item = $(item);\r\n            item.attr('data-page-number', index + 1);\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Make the given item active by setting the active class on it and firing\r\n     * the SHOW_PAGES event for the paged content to show the appropriate\r\n     * pages.\r\n     *\r\n     * @param {jquery} root The root element.\r\n     * @param {jquery} item The dropdown item.\r\n     * @param {string} id A unique id for this instance.\r\n     */\r\n    var setActiveItem = function(root, item, id) {\r\n        var prevItems = getPreviousItems(root, item);\r\n        var allItems = prevItems.add(item);\r\n        var eventPayload = generateEventPayload(root, allItems);\r\n        var toggle = root.find(SELECTORS.DROPDOWN_TOGGLE);\r\n        var caret = toggle.find(SELECTORS.CARET);\r\n\r\n        getActiveItem(root).removeClass('active');\r\n        item.addClass('active');\r\n\r\n        // Update the dropdown toggle to show which item is selected.\r\n        toggle.html(item.text());\r\n        // Bootstrap 2 compatibility.\r\n        toggle.append(caret);\r\n        // Fire the event to tell the content to update.\r\n        PubSub.publish(id + PagedContentEvents.SHOW_PAGES, eventPayload);\r\n    };\r\n\r\n    /**\r\n     * Initialise the module by firing the SHOW_PAGES event for an existing\r\n     * active page found and setting up the event listener for the user to select\r\n     * new pages.\r\n     *\r\n     * @param {object} root The root element.\r\n     * @param {string} id A unique id for this instance.\r\n     */\r\n    var init = function(root, id) {\r\n        root = $(root);\r\n        var items = getAllItems(root);\r\n        generatePageNumbers(items);\r\n\r\n        var activeItem = getActiveItem(root);\r\n        if (activeItem.length) {\r\n            // Fire the first event for the content to make sure it's visible.\r\n            setActiveItem(root, activeItem, id);\r\n        }\r\n\r\n        CustomEvents.define(root, [\r\n            CustomEvents.events.activate\r\n        ]);\r\n\r\n        root.on(CustomEvents.events.activate, SELECTORS.DROPDOWN_ITEM, function(e, data) {\r\n            var item = $(e.target).closest(SELECTORS.DROPDOWN_ITEM);\r\n            setActiveItem(root, item, id);\r\n\r\n            data.originalEvent.preventDefault();\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: init,\r\n        rootSelector: SELECTORS.ROOT,\r\n    };\r\n});\r\n"],"names":["define","$","CustomEvents","PagedContentEvents","PubSub","SELECTORS","getPageNumber","item","parseInt","attr","getAllItems","root","find","getPreviousItems","pageNumber","filter","index","element","getLimit","getOffset","undefined","offset","each","prevItem","getActiveItem","setActiveItem","id","eventPayload","items","map","limit","get","generateEventPayload","add","toggle","caret","removeClass","addClass","html","text","append","publish","SHOW_PAGES","init","generatePageNumbers","activeItem","length","events","activate","on","e","data","target","closest","originalEvent","preventDefault","rootSelector"],"mappings":";;;;;;;AAsBAA,4CACI,CACI,SACA,iCACA,4BACA,gBAEJ,SACIC,EACAC,aACAC,mBACAC,YAGAC,wBAEe,gCAFfA,0BAGiB,kCAHjBA,+BAIsB,uCAJtBA,gBAKO,wBASPC,cAAgB,SAASC,aAClBC,SAASD,KAAKE,KAAK,oBAAqB,KAS/CC,YAAc,SAASC,aAChBA,KAAKC,KAAKP,0BAWjBQ,iBAAmB,SAASF,KAAMJ,UAC9BO,WAAaR,cAAcC,aACxBG,YAAYC,MAAMI,QAAO,SAASC,MAAOC,gBACrCX,cAAcL,EAAEgB,UAAYH,eAUvCI,SAAW,SAASX,aACbC,SAASD,KAAKE,KAAK,mBAAoB,KAW9CU,UAAY,SAASR,KAAMJ,SACKa,MAA5Bb,KAAKE,KAAK,sBACHD,SAASD,KAAKE,KAAK,eAAgB,QAG1CY,OAAS,SAEbR,iBAAiBF,KAAMJ,MAAMe,MAAK,SAASN,MAAOO,UAC9CA,SAAWtB,EAAEsB,UACbF,QAAUH,SAASK,aAGvBhB,KAAKE,KAAK,cAAeY,QAClBA,QASPG,cAAgB,SAASb,aAClBA,KAAKC,KAAKP,iCAmEjBoB,cAAgB,SAASd,KAAMJ,KAAMmB,QAGjCC,aApCmB,SAAShB,KAAMiB,cAC/BA,MAAMC,KAAI,SAASb,MAAOT,aAC7BA,KAAON,EAAEM,MACF,CACHO,WAAYR,cAAcC,MAC1BuB,MAAOZ,SAASX,MAChBc,OAAQF,UAAUR,KAAMJ,UAE7BwB,MA4BgBC,CAAqBrB,KAFxBE,iBAAiBF,KAAMJ,MACd0B,IAAI1B,OAEzB2B,OAASvB,KAAKC,KAAKP,2BACnB8B,MAAQD,OAAOtB,KAAKP,iBAExBmB,cAAcb,MAAMyB,YAAY,UAChC7B,KAAK8B,SAAS,UAGdH,OAAOI,KAAK/B,KAAKgC,QAEjBL,OAAOM,OAAOL,OAEd/B,OAAOqC,QAAQf,GAAKvB,mBAAmBuC,WAAYf,qBAkChD,CACHgB,KAxBO,SAAShC,KAAMe,IACtBf,KAAOV,EAAEU,MA3Ca,SAASiB,OAC/BA,MAAMN,MAAK,SAASN,MAAOT,OACvBA,KAAON,EAAEM,OACJE,KAAK,mBAAoBO,MAAQ,MA0C1C4B,CADYlC,YAAYC,WAGpBkC,WAAarB,cAAcb,MAC3BkC,WAAWC,QAEXrB,cAAcd,KAAMkC,WAAYnB,IAGpCxB,aAAaF,OAAOW,KAAM,CACtBT,aAAa6C,OAAOC,WAGxBrC,KAAKsC,GAAG/C,aAAa6C,OAAOC,SAAU3C,yBAAyB,SAAS6C,EAAGC,UACnE5C,KAAON,EAAEiD,EAAEE,QAAQC,QAAQhD,yBAC/BoB,cAAcd,KAAMJ,KAAMmB,IAE1ByB,KAAKG,cAAcC,qBAMvBC,aAzMM"}