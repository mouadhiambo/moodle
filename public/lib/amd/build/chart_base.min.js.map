{"version":3,"file":"chart_base.min.js","sources":["../src/chart_base.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Chart base.\r\n *\r\n * @copyright  2016 Frédéric Massart - FMCorz.net\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @module     core/chart_base\r\n */\r\ndefine(['core/chart_series', 'core/chart_axis'], function(Series, Axis) {\r\n\r\n    /**\r\n     * Chart base.\r\n     *\r\n     * The constructor of a chart must never take any argument.\r\n     *\r\n     * {@link module:core/chart_base#_setDefault} to set the defaults on instantiation.\r\n     *\r\n     * @class\r\n     */\r\n    function Base() {\r\n        this._series = [];\r\n        this._labels = [];\r\n        this._xaxes = [];\r\n        this._yaxes = [];\r\n\r\n        this._setDefaults();\r\n    }\r\n\r\n    /**\r\n     * The series constituting this chart.\r\n     *\r\n     * @protected\r\n     * @type {module:core/chart_series[]}\r\n     */\r\n    Base.prototype._series = null;\r\n\r\n    /**\r\n     * The labels of the X axis when categorised.\r\n     *\r\n     * @protected\r\n     * @type {String[]}\r\n     */\r\n    Base.prototype._labels = null;\r\n\r\n    /**\r\n     * Options for chart legend display.\r\n     *\r\n     * @protected\r\n     * @type {Object}\r\n     */\r\n    Base.prototype._legendOptions = null;\r\n\r\n    /**\r\n     * The title of the chart.\r\n     *\r\n     * @protected\r\n     * @type {String}\r\n     */\r\n    Base.prototype._title = null;\r\n\r\n    /**\r\n     * The X axes.\r\n     *\r\n     * @protected\r\n     * @type {module:core/chart_axis[]}\r\n     */\r\n    Base.prototype._xaxes = null;\r\n\r\n    /**\r\n     * The Y axes.\r\n     *\r\n     * @protected\r\n     * @type {module:core/chart_axis[]}\r\n     */\r\n    Base.prototype._yaxes = null;\r\n\r\n    /**\r\n     * Colours to pick from when automatically assigning them.\r\n     *\r\n     * @const\r\n     * @type {String[]}\r\n     */\r\n    Base.prototype.COLORSET = ['#f3c300', '#875692', '#f38400', '#a1caf1', '#be0032', '#c2b280', '#7f180d', '#008856',\r\n            '#e68fac', '#0067a5'];\r\n\r\n    /**\r\n     * Set of colours defined by setting $CFG->chart_colorset to be picked when automatically assigning them.\r\n     *\r\n     * @type {String[]}\r\n     * @protected\r\n     */\r\n    Base.prototype._configColorSet = null;\r\n\r\n    /**\r\n     * The type of chart.\r\n     *\r\n     * @abstract\r\n     * @type {String}\r\n     * @const\r\n     */\r\n    Base.prototype.TYPE = null;\r\n\r\n    /**\r\n     * Options for chart responsiveness.\r\n     *\r\n     * @protected\r\n     * @type {Object}\r\n     */\r\n    Base.prototype._responsiveOptions = null;\r\n\r\n    /**\r\n     * Add a series to the chart.\r\n     *\r\n     * This will automatically assign a color to the series if it does not have one.\r\n     *\r\n     * @param {module:core/chart_series} series The series to add.\r\n     */\r\n    Base.prototype.addSeries = function(series) {\r\n        this._validateSeries(series);\r\n        this._series.push(series);\r\n\r\n        // Give a default color from the set.\r\n        if (series.getColor() === null) {\r\n            var configColorSet = this.getConfigColorSet() || Base.prototype.COLORSET;\r\n            series.setColor(configColorSet[this._series.length % configColorSet.length]);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Create a new instance of a chart from serialised data.\r\n     *\r\n     * the serialised attributes they offer and support.\r\n     *\r\n     * @static\r\n     * @method create\r\n     * @param {module:core/chart_base} Klass The class oject representing the type of chart to instantiate.\r\n     * @param {Object} data The data of the chart.\r\n     * @return {module:core/chart_base}\r\n     */\r\n    Base.prototype.create = function(Klass, data) {\r\n        // TODO Not convinced about the usage of Klass here but I can't figure out a way\r\n        // to have a reference to the class in the sub classes, in PHP I'd do new self().\r\n        var Chart = new Klass();\r\n        Chart.setConfigColorSet(data.config_colorset);\r\n        Chart.setLabels(data.labels);\r\n        Chart.setTitle(data.title);\r\n        if (data.legend_options) {\r\n            Chart.setLegendOptions(data.legend_options);\r\n        }\r\n        if (data.responsive_options) {\r\n            Chart.setResponsiveOptions(data.responsive_options);\r\n        }\r\n        data.series.forEach(function(seriesData) {\r\n            Chart.addSeries(Series.prototype.create(seriesData));\r\n        });\r\n        data.axes.x.forEach(function(axisData, i) {\r\n            Chart.setXAxis(Axis.prototype.create(axisData), i);\r\n        });\r\n        data.axes.y.forEach(function(axisData, i) {\r\n            Chart.setYAxis(Axis.prototype.create(axisData), i);\r\n        });\r\n        return Chart;\r\n    };\r\n\r\n    /**\r\n     * Get an axis.\r\n     *\r\n     * @private\r\n     * @param {String} xy Accepts the values 'x' or 'y'.\r\n     * @param {Number} [index=0] The index of the axis of its type.\r\n     * @param {Bool} [createIfNotExists=false] When true, create an instance if it does not exist.\r\n     * @return {module:core/chart_axis}\r\n     */\r\n    Base.prototype.__getAxis = function(xy, index, createIfNotExists) {\r\n        var axes = xy === 'x' ? this._xaxes : this._yaxes,\r\n            setAxis = (xy === 'x' ? this.setXAxis : this.setYAxis).bind(this),\r\n            axis;\r\n\r\n        index = typeof index === 'undefined' ? 0 : index;\r\n        createIfNotExists = typeof createIfNotExists === 'undefined' ? false : createIfNotExists;\r\n        axis = axes[index];\r\n\r\n        if (typeof axis === 'undefined') {\r\n            if (!createIfNotExists) {\r\n                throw new Error('Unknown axis.');\r\n            }\r\n            axis = new Axis();\r\n            setAxis(axis, index);\r\n        }\r\n\r\n        return axis;\r\n    };\r\n\r\n    /**\r\n     * Get colours defined by setting.\r\n     *\r\n     * @return {String[]}\r\n     */\r\n    Base.prototype.getConfigColorSet = function() {\r\n        return this._configColorSet;\r\n    };\r\n\r\n    /**\r\n     * Get the labels of the X axis.\r\n     *\r\n     * @return {String[]}\r\n     */\r\n    Base.prototype.getLabels = function() {\r\n        return this._labels;\r\n    };\r\n\r\n    /**\r\n     * Get whether to display the chart legend.\r\n     *\r\n     * @return {Bool}\r\n     */\r\n    Base.prototype.getLegendOptions = function() {\r\n        return this._legendOptions;\r\n    };\r\n\r\n    /**\r\n     * Get the series.\r\n     *\r\n     * @return {module:core/chart_series[]}\r\n     */\r\n    Base.prototype.getSeries = function() {\r\n        return this._series;\r\n    };\r\n\r\n    /**\r\n     * Get the title of the chart.\r\n     *\r\n     * @return {String}\r\n     */\r\n    Base.prototype.getTitle = function() {\r\n        return this._title;\r\n    };\r\n\r\n    /**\r\n     * Get the type of chart.\r\n     *\r\n     * @see module:core/chart_base#TYPE\r\n     * @return {String}\r\n     */\r\n    Base.prototype.getType = function() {\r\n        if (!this.TYPE) {\r\n            throw new Error('The TYPE property has not been set.');\r\n        }\r\n        return this.TYPE;\r\n    };\r\n\r\n    /**\r\n     * Get the X axes.\r\n     *\r\n     * @return {module:core/chart_axis[]}\r\n     */\r\n    Base.prototype.getXAxes = function() {\r\n        return this._xaxes;\r\n    };\r\n\r\n    /**\r\n     * Get an X axis.\r\n     *\r\n     * @param {Number} [index=0] The index of the axis.\r\n     * @param {Bool} [createIfNotExists=false] Create the instance of it does not exist at index.\r\n     * @return {module:core/chart_axis}\r\n     */\r\n    Base.prototype.getXAxis = function(index, createIfNotExists) {\r\n        return this.__getAxis('x', index, createIfNotExists);\r\n    };\r\n\r\n    /**\r\n     * Get the Y axes.\r\n     *\r\n     * @return {module:core/chart_axis[]}\r\n     */\r\n    Base.prototype.getYAxes = function() {\r\n        return this._yaxes;\r\n    };\r\n\r\n    /**\r\n     * Get an Y axis.\r\n     *\r\n     * @param {Number} [index=0] The index of the axis.\r\n     * @param {Bool} [createIfNotExists=false] Create the instance of it does not exist at index.\r\n     * @return {module:core/chart_axis}\r\n     */\r\n    Base.prototype.getYAxis = function(index, createIfNotExists) {\r\n        return this.__getAxis('y', index, createIfNotExists);\r\n    };\r\n\r\n    /**\r\n     * Get responsive options for the chart.\r\n     *\r\n     * @return {Object}\r\n     */\r\n    Base.prototype.getResponsiveOptions = function() {\r\n        return this._responsiveOptions;\r\n    };\r\n\r\n    /**\r\n     * Set colours defined by setting.\r\n     *\r\n     * @param {String[]} colorset An array of css colours.\r\n     * @protected\r\n     */\r\n    Base.prototype.setConfigColorSet = function(colorset) {\r\n        this._configColorSet = colorset;\r\n    };\r\n\r\n    /**\r\n     * Set the defaults for this chart type.\r\n     *\r\n     * Child classes can extend this to set defaults values on instantiation.\r\n     *\r\n     * emphasize and self-document the defaults values set by the chart type.\r\n     *\r\n     * @protected\r\n     */\r\n    Base.prototype._setDefaults = function() {\r\n        // For the children to extend.\r\n    };\r\n\r\n    /**\r\n     * Set the labels of the X axis.\r\n     *\r\n     * This requires for each series to contain strictly as many values as there\r\n     * are labels.\r\n     *\r\n     * @param {String[]} labels The labels.\r\n     */\r\n    Base.prototype.setLabels = function(labels) {\r\n        if (labels.length && this._series.length && this._series[0].length != labels.length) {\r\n            throw new Error('Series must match label values.');\r\n        }\r\n        this._labels = labels;\r\n    };\r\n\r\n    /**\r\n     * Set options for chart legend display.\r\n     *\r\n     * @param {Object} legendOptions\r\n     */\r\n    Base.prototype.setLegendOptions = function(legendOptions) {\r\n        if (typeof legendOptions !== 'object') {\r\n            throw new Error('Setting legend with non-object value:' + legendOptions);\r\n        }\r\n        this._legendOptions = legendOptions;\r\n    };\r\n\r\n    /**\r\n     * Set the title of the chart.\r\n     *\r\n     * @param {String} title The title.\r\n     */\r\n    Base.prototype.setTitle = function(title) {\r\n        this._title = title;\r\n    };\r\n\r\n    /**\r\n     * Set an X axis.\r\n     *\r\n     * Note that this will override any predefined axis without warning.\r\n     *\r\n     * @param {module:core/chart_axis} axis The axis.\r\n     * @param {Number} [index=0] The index of the axis.\r\n     */\r\n    Base.prototype.setXAxis = function(axis, index) {\r\n        index = typeof index === 'undefined' ? 0 : index;\r\n        this._validateAxis('x', axis, index);\r\n        this._xaxes[index] = axis;\r\n    };\r\n\r\n    /**\r\n     * Set a Y axis.\r\n     *\r\n     * Note that this will override any predefined axis without warning.\r\n     *\r\n     * @param {module:core/chart_axis} axis The axis.\r\n     * @param {Number} [index=0] The index of the axis.\r\n     */\r\n    Base.prototype.setYAxis = function(axis, index) {\r\n        index = typeof index === 'undefined' ? 0 : index;\r\n        this._validateAxis('y', axis, index);\r\n        this._yaxes[index] = axis;\r\n    };\r\n\r\n    /**\r\n     * Set responsive options for chart.\r\n     *\r\n     * @param {Object} responsiveOptions\r\n     */\r\n    Base.prototype.setResponsiveOptions = function(responsiveOptions) {\r\n        if (typeof responsiveOptions !== 'object') {\r\n            throw new Error('Setting responsive options with non-object value:' + responsiveOptions);\r\n        }\r\n        this._responsiveOptions = responsiveOptions;\r\n    };\r\n\r\n    /**\r\n     * Validate an axis.\r\n     *\r\n     * @protected\r\n     * @param {String} xy X or Y axis.\r\n     * @param {module:core/chart_axis} axis The axis to validate.\r\n     * @param {Number} [index=0] The index of the axis.\r\n     */\r\n    Base.prototype._validateAxis = function(xy, axis, index) {\r\n        index = typeof index === 'undefined' ? 0 : index;\r\n        if (index > 0) {\r\n            var axes = xy == 'x' ? this._xaxes : this._yaxes;\r\n            if (typeof axes[index - 1] === 'undefined') {\r\n                throw new Error('Missing ' + xy + ' axis at index lower than ' + index);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Validate a series.\r\n     *\r\n     * @protected\r\n     * @param {module:core/chart_series} series The series to validate.\r\n     */\r\n    Base.prototype._validateSeries = function(series) {\r\n        if (this._series.length && this._series[0].getCount() != series.getCount()) {\r\n            throw new Error('Series do not have an equal number of values.');\r\n\r\n        } else if (this._labels.length && this._labels.length != series.getCount()) {\r\n            throw new Error('Series must match label values.');\r\n        }\r\n    };\r\n\r\n    return Base;\r\n\r\n});\r\n"],"names":["define","Series","Axis","Base","_series","_labels","_xaxes","_yaxes","_setDefaults","prototype","_legendOptions","_title","COLORSET","_configColorSet","TYPE","_responsiveOptions","addSeries","series","_validateSeries","push","getColor","configColorSet","this","getConfigColorSet","setColor","length","create","Klass","data","Chart","setConfigColorSet","config_colorset","setLabels","labels","setTitle","title","legend_options","setLegendOptions","responsive_options","setResponsiveOptions","forEach","seriesData","axes","x","axisData","i","setXAxis","y","setYAxis","__getAxis","xy","index","createIfNotExists","axis","setAxis","bind","Error","getLabels","getLegendOptions","getSeries","getTitle","getType","getXAxes","getXAxis","getYAxes","getYAxis","getResponsiveOptions","colorset","legendOptions","_validateAxis","responsiveOptions","getCount"],"mappings":"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"}