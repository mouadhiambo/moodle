{"version":3,"file":"scrollspy.min.js","sources":["../../src/bootstrap/scrollspy.js"],"sourcesContent":["/**\r\n * --------------------------------------------------------------------------\r\n * Bootstrap scrollspy.js\r\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\r\n * --------------------------------------------------------------------------\r\n */\r\n\r\nimport BaseComponent from './base-component'\r\nimport EventHandler from './dom/event-handler'\r\nimport SelectorEngine from './dom/selector-engine'\r\nimport {\r\n  defineJQueryPlugin, getElement, isDisabled, isVisible\r\n} from './util/index'\r\n\r\n/**\r\n * Constants\r\n */\r\n\r\nconst NAME = 'scrollspy'\r\nconst DATA_KEY = 'bs.scrollspy'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst DATA_API_KEY = '.data-api'\r\n\r\nconst EVENT_ACTIVATE = `activate${EVENT_KEY}`\r\nconst EVENT_CLICK = `click${EVENT_KEY}`\r\nconst EVENT_LOAD_DATA_API = `load${EVENT_KEY}${DATA_API_KEY}`\r\n\r\nconst CLASS_NAME_DROPDOWN_ITEM = 'dropdown-item'\r\nconst CLASS_NAME_ACTIVE = 'active'\r\n\r\nconst SELECTOR_DATA_SPY = '[data-bs-spy=\"scroll\"]'\r\nconst SELECTOR_TARGET_LINKS = '[href]'\r\nconst SELECTOR_NAV_LIST_GROUP = '.nav, .list-group'\r\nconst SELECTOR_NAV_LINKS = '.nav-link'\r\nconst SELECTOR_NAV_ITEMS = '.nav-item'\r\nconst SELECTOR_LIST_ITEMS = '.list-group-item'\r\nconst SELECTOR_LINK_ITEMS = `${SELECTOR_NAV_LINKS}, ${SELECTOR_NAV_ITEMS} > ${SELECTOR_NAV_LINKS}, ${SELECTOR_LIST_ITEMS}`\r\nconst SELECTOR_DROPDOWN = '.dropdown'\r\nconst SELECTOR_DROPDOWN_TOGGLE = '.dropdown-toggle'\r\n\r\nconst Default = {\r\n  offset: null, // TODO: v6 @deprecated, keep it for backwards compatibility reasons\r\n  rootMargin: '0px 0px -25%',\r\n  smoothScroll: false,\r\n  target: null,\r\n  threshold: [0.1, 0.5, 1]\r\n}\r\n\r\nconst DefaultType = {\r\n  offset: '(number|null)', // TODO v6 @deprecated, keep it for backwards compatibility reasons\r\n  rootMargin: 'string',\r\n  smoothScroll: 'boolean',\r\n  target: 'element',\r\n  threshold: 'array'\r\n}\r\n\r\n/**\r\n * Class definition\r\n */\r\n\r\nclass ScrollSpy extends BaseComponent {\r\n  constructor(element, config) {\r\n    super(element, config)\r\n\r\n    // this._element is the observablesContainer and config.target the menu links wrapper\r\n    this._targetLinks = new Map()\r\n    this._observableSections = new Map()\r\n    this._rootElement = getComputedStyle(this._element).overflowY === 'visible' ? null : this._element\r\n    this._activeTarget = null\r\n    this._observer = null\r\n    this._previousScrollData = {\r\n      visibleEntryTop: 0,\r\n      parentScrollTop: 0\r\n    }\r\n    this.refresh() // initialize\r\n  }\r\n\r\n  // Getters\r\n  static get Default() {\r\n    return Default\r\n  }\r\n\r\n  static get DefaultType() {\r\n    return DefaultType\r\n  }\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  refresh() {\r\n    this._initializeTargetsAndObservables()\r\n    this._maybeEnableSmoothScroll()\r\n\r\n    if (this._observer) {\r\n      this._observer.disconnect()\r\n    } else {\r\n      this._observer = this._getNewObserver()\r\n    }\r\n\r\n    for (const section of this._observableSections.values()) {\r\n      this._observer.observe(section)\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    this._observer.disconnect()\r\n    super.dispose()\r\n  }\r\n\r\n  // Private\r\n  _configAfterMerge(config) {\r\n    // TODO: on v6 target should be given explicitly & remove the {target: 'ss-target'} case\r\n    config.target = getElement(config.target) || document.body\r\n\r\n    // TODO: v6 Only for backwards compatibility reasons. Use rootMargin only\r\n    config.rootMargin = config.offset ? `${config.offset}px 0px -30%` : config.rootMargin\r\n\r\n    if (typeof config.threshold === 'string') {\r\n      config.threshold = config.threshold.split(',').map(value => Number.parseFloat(value))\r\n    }\r\n\r\n    return config\r\n  }\r\n\r\n  _maybeEnableSmoothScroll() {\r\n    if (!this._config.smoothScroll) {\r\n      return\r\n    }\r\n\r\n    // unregister any previous listeners\r\n    EventHandler.off(this._config.target, EVENT_CLICK)\r\n\r\n    EventHandler.on(this._config.target, EVENT_CLICK, SELECTOR_TARGET_LINKS, event => {\r\n      const observableSection = this._observableSections.get(event.target.hash)\r\n      if (observableSection) {\r\n        event.preventDefault()\r\n        const root = this._rootElement || window\r\n        const height = observableSection.offsetTop - this._element.offsetTop\r\n        if (root.scrollTo) {\r\n          root.scrollTo({ top: height, behavior: 'smooth' })\r\n          return\r\n        }\r\n\r\n        // Chrome 60 doesn't support `scrollTo`\r\n        root.scrollTop = height\r\n      }\r\n    })\r\n  }\r\n\r\n  _getNewObserver() {\r\n    const options = {\r\n      root: this._rootElement,\r\n      threshold: this._config.threshold,\r\n      rootMargin: this._config.rootMargin\r\n    }\r\n\r\n    return new IntersectionObserver(entries => this._observerCallback(entries), options)\r\n  }\r\n\r\n  // The logic of selection\r\n  _observerCallback(entries) {\r\n    const targetElement = entry => this._targetLinks.get(`#${entry.target.id}`)\r\n    const activate = entry => {\r\n      this._previousScrollData.visibleEntryTop = entry.target.offsetTop\r\n      this._process(targetElement(entry))\r\n    }\r\n\r\n    const parentScrollTop = (this._rootElement || document.documentElement).scrollTop\r\n    const userScrollsDown = parentScrollTop >= this._previousScrollData.parentScrollTop\r\n    this._previousScrollData.parentScrollTop = parentScrollTop\r\n\r\n    for (const entry of entries) {\r\n      if (!entry.isIntersecting) {\r\n        this._activeTarget = null\r\n        this._clearActiveClass(targetElement(entry))\r\n\r\n        continue\r\n      }\r\n\r\n      const entryIsLowerThanPrevious = entry.target.offsetTop >= this._previousScrollData.visibleEntryTop\r\n      // if we are scrolling down, pick the bigger offsetTop\r\n      if (userScrollsDown && entryIsLowerThanPrevious) {\r\n        activate(entry)\r\n        // if parent isn't scrolled, let's keep the first visible item, breaking the iteration\r\n        if (!parentScrollTop) {\r\n          return\r\n        }\r\n\r\n        continue\r\n      }\r\n\r\n      // if we are scrolling up, pick the smallest offsetTop\r\n      if (!userScrollsDown && !entryIsLowerThanPrevious) {\r\n        activate(entry)\r\n      }\r\n    }\r\n  }\r\n\r\n  _initializeTargetsAndObservables() {\r\n    this._targetLinks = new Map()\r\n    this._observableSections = new Map()\r\n\r\n    const targetLinks = SelectorEngine.find(SELECTOR_TARGET_LINKS, this._config.target)\r\n\r\n    for (const anchor of targetLinks) {\r\n      // ensure that the anchor has an id and is not disabled\r\n      if (!anchor.hash || isDisabled(anchor)) {\r\n        continue\r\n      }\r\n\r\n      const observableSection = SelectorEngine.findOne(decodeURI(anchor.hash), this._element)\r\n\r\n      // ensure that the observableSection exists & is visible\r\n      if (isVisible(observableSection)) {\r\n        this._targetLinks.set(decodeURI(anchor.hash), anchor)\r\n        this._observableSections.set(anchor.hash, observableSection)\r\n      }\r\n    }\r\n  }\r\n\r\n  _process(target) {\r\n    if (this._activeTarget === target) {\r\n      return\r\n    }\r\n\r\n    this._clearActiveClass(this._config.target)\r\n    this._activeTarget = target\r\n    target.classList.add(CLASS_NAME_ACTIVE)\r\n    this._activateParents(target)\r\n\r\n    EventHandler.trigger(this._element, EVENT_ACTIVATE, { relatedTarget: target })\r\n  }\r\n\r\n  _activateParents(target) {\r\n    // Activate dropdown parents\r\n    if (target.classList.contains(CLASS_NAME_DROPDOWN_ITEM)) {\r\n      SelectorEngine.findOne(SELECTOR_DROPDOWN_TOGGLE, target.closest(SELECTOR_DROPDOWN))\r\n        .classList.add(CLASS_NAME_ACTIVE)\r\n      return\r\n    }\r\n\r\n    for (const listGroup of SelectorEngine.parents(target, SELECTOR_NAV_LIST_GROUP)) {\r\n      // Set triggered links parents as active\r\n      // With both <ul> and <nav> markup a parent is the previous sibling of any nav ancestor\r\n      for (const item of SelectorEngine.prev(listGroup, SELECTOR_LINK_ITEMS)) {\r\n        item.classList.add(CLASS_NAME_ACTIVE)\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearActiveClass(parent) {\r\n    parent.classList.remove(CLASS_NAME_ACTIVE)\r\n\r\n    const activeNodes = SelectorEngine.find(`${SELECTOR_TARGET_LINKS}.${CLASS_NAME_ACTIVE}`, parent)\r\n    for (const node of activeNodes) {\r\n      node.classList.remove(CLASS_NAME_ACTIVE)\r\n    }\r\n  }\r\n\r\n  // Static\r\n  static jQueryInterface(config) {\r\n    return this.each(function () {\r\n      const data = ScrollSpy.getOrCreateInstance(this, config)\r\n\r\n      if (typeof config !== 'string') {\r\n        return\r\n      }\r\n\r\n      if (data[config] === undefined || config.startsWith('_') || config === 'constructor') {\r\n        throw new TypeError(`No method named \"${config}\"`)\r\n      }\r\n\r\n      data[config]()\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Data API implementation\r\n */\r\n\r\nEventHandler.on(window, EVENT_LOAD_DATA_API, () => {\r\n  for (const spy of SelectorEngine.find(SELECTOR_DATA_SPY)) {\r\n    ScrollSpy.getOrCreateInstance(spy)\r\n  }\r\n})\r\n\r\n/**\r\n * jQuery\r\n */\r\n\r\ndefineJQueryPlugin(ScrollSpy)\r\n\r\nexport default ScrollSpy\r\n"],"names":["EVENT_KEY","EVENT_ACTIVATE","EVENT_CLICK","EVENT_LOAD_DATA_API","SELECTOR_LINK_ITEMS","Default","offset","rootMargin","smoothScroll","target","threshold","DefaultType","ScrollSpy","BaseComponent","constructor","element","config","_targetLinks","Map","_observableSections","_rootElement","getComputedStyle","this","_element","overflowY","_activeTarget","_observer","_previousScrollData","visibleEntryTop","parentScrollTop","refresh","NAME","_initializeTargetsAndObservables","_maybeEnableSmoothScroll","disconnect","_getNewObserver","section","values","observe","dispose","_configAfterMerge","document","body","split","map","value","Number","parseFloat","_config","off","on","event","observableSection","get","hash","preventDefault","root","window","height","offsetTop","scrollTo","top","behavior","scrollTop","options","IntersectionObserver","entries","_observerCallback","targetElement","entry","id","activate","_process","documentElement","userScrollsDown","isIntersecting","_clearActiveClass","entryIsLowerThanPrevious","targetLinks","SelectorEngine","find","anchor","findOne","decodeURI","set","classList","add","_activateParents","trigger","relatedTarget","contains","closest","listGroup","parents","item","prev","parent","remove","activeNodes","node","each","data","getOrCreateInstance","undefined","startsWith","TypeError","spy"],"mappings":"uhBAoBMA,qBADW,gBAIXC,iCAA4BD,WAC5BE,2BAAsBF,WACtBG,kCAA6BH,kBAJd,aAefI,8BAHqB,yBACA,0BADA,yBAEC,oBAKtBC,QAAU,CACdC,OAAQ,KACRC,WAAY,eACZC,cAAc,EACdC,OAAQ,KACRC,UAAW,CAAC,GAAK,GAAK,IAGlBC,YAAc,CAClBL,OAAQ,gBACRC,WAAY,SACZC,aAAc,UACdC,OAAQ,UACRC,UAAW,eAOPE,kBAAkBC,uBACtBC,YAAYC,QAASC,cACbD,QAASC,aAGVC,aAAe,IAAIC,SACnBC,oBAAsB,IAAID,SAC1BE,aAA6D,YAA9CC,iBAAiBC,KAAKC,UAAUC,UAA0B,KAAOF,KAAKC,cACrFE,cAAgB,UAChBC,UAAY,UACZC,oBAAsB,CACzBC,gBAAiB,EACjBC,gBAAiB,QAEdC,UAIIzB,4BACFA,QAGEM,gCACFA,YAGEoB,wBApEA,YAyEXD,eACOE,wCACAC,2BAEDX,KAAKI,eACFA,UAAUQ,kBAEVR,UAAYJ,KAAKa,sBAGnB,MAAMC,WAAWd,KAAKH,oBAAoBkB,cACxCX,UAAUY,QAAQF,SAI3BG,eACOb,UAAUQ,mBACTK,UAIRC,kBAAkBxB,eAEhBA,OAAOP,QAAS,qBAAWO,OAAOP,SAAWgC,SAASC,KAGtD1B,OAAOT,WAAaS,OAAOV,iBAAYU,OAAOV,sBAAsBU,OAAOT,WAE3C,iBAArBS,OAAON,YAChBM,OAAON,UAAYM,OAAON,UAAUiC,MAAM,KAAKC,KAAIC,OAASC,OAAOC,WAAWF,UAGzE7B,OAGTiB,2BACOX,KAAK0B,QAAQxC,qCAKLyC,IAAI3B,KAAK0B,QAAQvC,OAAQP,mCAEzBgD,GAAG5B,KAAK0B,QAAQvC,OAAQP,YAvGX,UAuG+CiD,cACjEC,kBAAoB9B,KAAKH,oBAAoBkC,IAAIF,MAAM1C,OAAO6C,SAChEF,kBAAmB,CACrBD,MAAMI,uBACAC,KAAOlC,KAAKF,cAAgBqC,OAC5BC,OAASN,kBAAkBO,UAAYrC,KAAKC,SAASoC,aACvDH,KAAKI,qBACPJ,KAAKI,SAAS,CAAEC,IAAKH,OAAQI,SAAU,WAKzCN,KAAKO,UAAYL,YAKvBvB,wBACQ6B,QAAU,CACdR,KAAMlC,KAAKF,aACXV,UAAWY,KAAK0B,QAAQtC,UACxBH,WAAYe,KAAK0B,QAAQzC,mBAGpB,IAAI0D,sBAAqBC,SAAW5C,KAAK6C,kBAAkBD,UAAUF,SAI9EG,kBAAkBD,eACVE,cAAgBC,OAAS/C,KAAKL,aAAaoC,eAAQgB,MAAM5D,OAAO6D,KAChEC,SAAWF,aACV1C,oBAAoBC,gBAAkByC,MAAM5D,OAAOkD,eACnDa,SAASJ,cAAcC,SAGxBxC,iBAAmBP,KAAKF,cAAgBqB,SAASgC,iBAAiBV,UAClEW,gBAAkB7C,iBAAmBP,KAAKK,oBAAoBE,qBAC/DF,oBAAoBE,gBAAkBA,oBAEtC,MAAMwC,SAASH,QAAS,KACtBG,MAAMM,eAAgB,MACpBlD,cAAgB,UAChBmD,kBAAkBR,cAAcC,uBAKjCQ,yBAA2BR,MAAM5D,OAAOkD,WAAarC,KAAKK,oBAAoBC,mBAEhF8C,iBAAmBG,6BACrBN,SAASF,QAEJxC,4BAQF6C,iBAAoBG,0BACvBN,SAASF,QAKfrC,wCACOf,aAAe,IAAIC,SACnBC,oBAAsB,IAAID,UAEzB4D,YAAcC,wBAAeC,KA7KT,SA6KqC1D,KAAK0B,QAAQvC,YAEvE,MAAMwE,UAAUH,YAAa,KAE3BG,OAAO3B,OAAQ,qBAAW2B,uBAIzB7B,kBAAoB2B,wBAAeG,QAAQC,UAAUF,OAAO3B,MAAOhC,KAAKC,WAG1E,oBAAU6B,0BACPnC,aAAamE,IAAID,UAAUF,OAAO3B,MAAO2B,aACzC9D,oBAAoBiE,IAAIH,OAAO3B,KAAMF,qBAKhDoB,SAAS/D,QACHa,KAAKG,gBAAkBhB,cAItBmE,kBAAkBtD,KAAK0B,QAAQvC,aAC/BgB,cAAgBhB,OACrBA,OAAO4E,UAAUC,IAzMK,eA0MjBC,iBAAiB9E,8BAET+E,QAAQlE,KAAKC,SAAUtB,eAAgB,CAAEwF,cAAehF,UAGvE8E,iBAAiB9E,WAEXA,OAAO4E,UAAUK,SAlNQ,yCAmNZR,QAxMY,mBAwMsBzE,OAAOkF,QAzMpC,cA0MjBN,UAAUC,IAnNO,mBAuNjB,MAAMM,aAAab,wBAAec,QAAQpF,OAnNnB,yBAsNrB,MAAMqF,QAAQf,wBAAegB,KAAKH,UAAWxF,qBAChD0F,KAAKT,UAAUC,IA3NG,UAgOxBV,kBAAkBoB,QAChBA,OAAOX,UAAUY,OAjOK,gBAmOhBC,YAAcnB,wBAAeC,eAhOT,qBAHJ,UAmOmEgB,YACpF,MAAMG,QAAQD,YACjBC,KAAKd,UAAUY,OArOK,iCA0ODjF,eACdM,KAAK8E,MAAK,iBACTC,KAAOzF,UAAU0F,oBAAoBhF,KAAMN,WAE3B,iBAAXA,gBAIUuF,IAAjBF,KAAKrF,SAAyBA,OAAOwF,WAAW,MAAmB,gBAAXxF,aACpD,IAAIyF,qCAA8BzF,aAG1CqF,KAAKrF,qCASEkC,GAAGO,OAAQtD,qBAAqB,SACtC,MAAMuG,OAAO3B,wBAAeC,KA9PT,0BA+PtBpE,UAAU0F,oBAAoBI,sCAQf9F,wBAEJA"}