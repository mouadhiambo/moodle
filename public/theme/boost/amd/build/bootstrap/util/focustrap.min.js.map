{"version":3,"file":"focustrap.min.js","sources":["../../../src/bootstrap/util/focustrap.js"],"sourcesContent":["/**\r\n * --------------------------------------------------------------------------\r\n * Bootstrap util/focustrap.js\r\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\r\n * --------------------------------------------------------------------------\r\n */\r\n\r\nimport EventHandler from '../dom/event-handler'\r\nimport SelectorEngine from '../dom/selector-engine'\r\nimport Config from './config'\r\n\r\n/**\r\n * Constants\r\n */\r\n\r\nconst NAME = 'focustrap'\r\nconst DATA_KEY = 'bs.focustrap'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst EVENT_FOCUSIN = `focusin${EVENT_KEY}`\r\nconst EVENT_KEYDOWN_TAB = `keydown.tab${EVENT_KEY}`\r\n\r\nconst TAB_KEY = 'Tab'\r\nconst TAB_NAV_FORWARD = 'forward'\r\nconst TAB_NAV_BACKWARD = 'backward'\r\n\r\nconst Default = {\r\n  autofocus: true,\r\n  trapElement: null // The element to trap focus inside of\r\n}\r\n\r\nconst DefaultType = {\r\n  autofocus: 'boolean',\r\n  trapElement: 'element'\r\n}\r\n\r\n/**\r\n * Class definition\r\n */\r\n\r\nclass FocusTrap extends Config {\r\n  constructor(config) {\r\n    super()\r\n    this._config = this._getConfig(config)\r\n    this._isActive = false\r\n    this._lastTabNavDirection = null\r\n  }\r\n\r\n  // Getters\r\n  static get Default() {\r\n    return Default\r\n  }\r\n\r\n  static get DefaultType() {\r\n    return DefaultType\r\n  }\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  activate() {\r\n    if (this._isActive) {\r\n      return\r\n    }\r\n\r\n    if (this._config.autofocus) {\r\n      this._config.trapElement.focus()\r\n    }\r\n\r\n    EventHandler.off(document, EVENT_KEY) // guard against infinite focus loop\r\n    EventHandler.on(document, EVENT_FOCUSIN, event => this._handleFocusin(event))\r\n    EventHandler.on(document, EVENT_KEYDOWN_TAB, event => this._handleKeydown(event))\r\n\r\n    this._isActive = true\r\n  }\r\n\r\n  deactivate() {\r\n    if (!this._isActive) {\r\n      return\r\n    }\r\n\r\n    this._isActive = false\r\n    EventHandler.off(document, EVENT_KEY)\r\n  }\r\n\r\n  // Private\r\n  _handleFocusin(event) {\r\n    const { trapElement } = this._config\r\n\r\n    if (event.target === document || event.target === trapElement || trapElement.contains(event.target)) {\r\n      return\r\n    }\r\n\r\n    const elements = SelectorEngine.focusableChildren(trapElement)\r\n\r\n    if (elements.length === 0) {\r\n      trapElement.focus()\r\n    } else if (this._lastTabNavDirection === TAB_NAV_BACKWARD) {\r\n      elements[elements.length - 1].focus()\r\n    } else {\r\n      elements[0].focus()\r\n    }\r\n  }\r\n\r\n  _handleKeydown(event) {\r\n    if (event.key !== TAB_KEY) {\r\n      return\r\n    }\r\n\r\n    this._lastTabNavDirection = event.shiftKey ? TAB_NAV_BACKWARD : TAB_NAV_FORWARD\r\n  }\r\n}\r\n\r\nexport default FocusTrap\r\n"],"names":["EVENT_KEY","EVENT_FOCUSIN","EVENT_KEYDOWN_TAB","Default","autofocus","trapElement","DefaultType","FocusTrap","Config","constructor","config","_config","this","_getConfig","_isActive","_lastTabNavDirection","NAME","activate","focus","off","document","on","event","_handleFocusin","_handleKeydown","deactivate","target","contains","elements","SelectorEngine","focusableChildren","length","key","shiftKey"],"mappings":"2eAiBMA,qBADW,gBAEXC,+BAA0BD,WAC1BE,uCAAkCF,WAMlCG,QAAU,CACdC,WAAW,EACXC,YAAa,MAGTC,YAAc,CAClBF,UAAW,UACXC,YAAa,iBAOTE,kBAAkBC,gBACtBC,YAAYC,qBAELC,QAAUC,KAAKC,WAAWH,aAC1BI,WAAY,OACZC,qBAAuB,KAInBZ,4BACFA,QAGEG,gCACFA,YAGEU,wBAzCA,YA8CXC,WACML,KAAKE,YAILF,KAAKD,QAAQP,gBACVO,QAAQN,YAAYa,8BAGdC,IAAIC,SAAUpB,iCACdqB,GAAGD,SAAUnB,eAAeqB,OAASV,KAAKW,eAAeD,+BACzDD,GAAGD,SAAUlB,mBAAmBoB,OAASV,KAAKY,eAAeF,cAErER,WAAY,GAGnBW,aACOb,KAAKE,iBAILA,WAAY,wBACJK,IAAIC,SAAUpB,YAI7BuB,eAAeD,aACPjB,YAAEA,aAAgBO,KAAKD,WAEzBW,MAAMI,SAAWN,UAAYE,MAAMI,SAAWrB,aAAeA,YAAYsB,SAASL,MAAMI,qBAItFE,SAAWC,wBAAeC,kBAAkBzB,aAE1B,IAApBuB,SAASG,OACX1B,YAAYa,QA1EO,aA2EVN,KAAKG,qBACda,SAASA,SAASG,OAAS,GAAGb,QAE9BU,SAAS,GAAGV,QAIhBM,eAAeF,OApFD,QAqFRA,MAAMU,WAILjB,qBAAuBO,MAAMW,SAvFb,WADD,yBA4FT1B"}