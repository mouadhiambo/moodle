{"version":3,"file":"offcanvas.min.js","sources":["../../src/bootstrap/offcanvas.js"],"sourcesContent":["/**\r\n * --------------------------------------------------------------------------\r\n * Bootstrap offcanvas.js\r\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\r\n * --------------------------------------------------------------------------\r\n */\r\n\r\nimport BaseComponent from './base-component'\r\nimport EventHandler from './dom/event-handler'\r\nimport SelectorEngine from './dom/selector-engine'\r\nimport Backdrop from './util/backdrop'\r\nimport { enableDismissTrigger } from './util/component-functions'\r\nimport FocusTrap from './util/focustrap'\r\nimport {\r\n  defineJQueryPlugin,\r\n  isDisabled,\r\n  isVisible\r\n} from './util/index'\r\nimport ScrollBarHelper from './util/scrollbar'\r\n\r\n/**\r\n * Constants\r\n */\r\n\r\nconst NAME = 'offcanvas'\r\nconst DATA_KEY = 'bs.offcanvas'\r\nconst EVENT_KEY = `.${DATA_KEY}`\r\nconst DATA_API_KEY = '.data-api'\r\nconst EVENT_LOAD_DATA_API = `load${EVENT_KEY}${DATA_API_KEY}`\r\nconst ESCAPE_KEY = 'Escape'\r\n\r\nconst CLASS_NAME_SHOW = 'show'\r\nconst CLASS_NAME_SHOWING = 'showing'\r\nconst CLASS_NAME_HIDING = 'hiding'\r\nconst CLASS_NAME_BACKDROP = 'offcanvas-backdrop'\r\nconst OPEN_SELECTOR = '.offcanvas.show'\r\n\r\nconst EVENT_SHOW = `show${EVENT_KEY}`\r\nconst EVENT_SHOWN = `shown${EVENT_KEY}`\r\nconst EVENT_HIDE = `hide${EVENT_KEY}`\r\nconst EVENT_HIDE_PREVENTED = `hidePrevented${EVENT_KEY}`\r\nconst EVENT_HIDDEN = `hidden${EVENT_KEY}`\r\nconst EVENT_RESIZE = `resize${EVENT_KEY}`\r\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\r\nconst EVENT_KEYDOWN_DISMISS = `keydown.dismiss${EVENT_KEY}`\r\n\r\nconst SELECTOR_DATA_TOGGLE = '[data-bs-toggle=\"offcanvas\"]'\r\n\r\nconst Default = {\r\n  backdrop: true,\r\n  keyboard: true,\r\n  scroll: false\r\n}\r\n\r\nconst DefaultType = {\r\n  backdrop: '(boolean|string)',\r\n  keyboard: 'boolean',\r\n  scroll: 'boolean'\r\n}\r\n\r\n/**\r\n * Class definition\r\n */\r\n\r\nclass Offcanvas extends BaseComponent {\r\n  constructor(element, config) {\r\n    super(element, config)\r\n\r\n    this._isShown = false\r\n    this._backdrop = this._initializeBackDrop()\r\n    this._focustrap = this._initializeFocusTrap()\r\n    this._addEventListeners()\r\n  }\r\n\r\n  // Getters\r\n  static get Default() {\r\n    return Default\r\n  }\r\n\r\n  static get DefaultType() {\r\n    return DefaultType\r\n  }\r\n\r\n  static get NAME() {\r\n    return NAME\r\n  }\r\n\r\n  // Public\r\n  toggle(relatedTarget) {\r\n    return this._isShown ? this.hide() : this.show(relatedTarget)\r\n  }\r\n\r\n  show(relatedTarget) {\r\n    if (this._isShown) {\r\n      return\r\n    }\r\n\r\n    const showEvent = EventHandler.trigger(this._element, EVENT_SHOW, { relatedTarget })\r\n\r\n    if (showEvent.defaultPrevented) {\r\n      return\r\n    }\r\n\r\n    this._isShown = true\r\n    this._backdrop.show()\r\n\r\n    if (!this._config.scroll) {\r\n      new ScrollBarHelper().hide()\r\n    }\r\n\r\n    this._element.setAttribute('aria-modal', true)\r\n    this._element.setAttribute('role', 'dialog')\r\n    this._element.classList.add(CLASS_NAME_SHOWING)\r\n\r\n    const completeCallBack = () => {\r\n      if (!this._config.scroll || this._config.backdrop) {\r\n        this._focustrap.activate()\r\n      }\r\n\r\n      this._element.classList.add(CLASS_NAME_SHOW)\r\n      this._element.classList.remove(CLASS_NAME_SHOWING)\r\n      EventHandler.trigger(this._element, EVENT_SHOWN, { relatedTarget })\r\n    }\r\n\r\n    this._queueCallback(completeCallBack, this._element, true)\r\n  }\r\n\r\n  hide() {\r\n    if (!this._isShown) {\r\n      return\r\n    }\r\n\r\n    const hideEvent = EventHandler.trigger(this._element, EVENT_HIDE)\r\n\r\n    if (hideEvent.defaultPrevented) {\r\n      return\r\n    }\r\n\r\n    this._focustrap.deactivate()\r\n    this._element.blur()\r\n    this._isShown = false\r\n    this._element.classList.add(CLASS_NAME_HIDING)\r\n    this._backdrop.hide()\r\n\r\n    const completeCallback = () => {\r\n      this._element.classList.remove(CLASS_NAME_SHOW, CLASS_NAME_HIDING)\r\n      this._element.removeAttribute('aria-modal')\r\n      this._element.removeAttribute('role')\r\n\r\n      if (!this._config.scroll) {\r\n        new ScrollBarHelper().reset()\r\n      }\r\n\r\n      EventHandler.trigger(this._element, EVENT_HIDDEN)\r\n    }\r\n\r\n    this._queueCallback(completeCallback, this._element, true)\r\n  }\r\n\r\n  dispose() {\r\n    this._backdrop.dispose()\r\n    this._focustrap.deactivate()\r\n    super.dispose()\r\n  }\r\n\r\n  // Private\r\n  _initializeBackDrop() {\r\n    const clickCallback = () => {\r\n      if (this._config.backdrop === 'static') {\r\n        EventHandler.trigger(this._element, EVENT_HIDE_PREVENTED)\r\n        return\r\n      }\r\n\r\n      this.hide()\r\n    }\r\n\r\n    // 'static' option will be translated to true, and booleans will keep their value\r\n    const isVisible = Boolean(this._config.backdrop)\r\n\r\n    return new Backdrop({\r\n      className: CLASS_NAME_BACKDROP,\r\n      isVisible,\r\n      isAnimated: true,\r\n      rootElement: this._element.parentNode,\r\n      clickCallback: isVisible ? clickCallback : null\r\n    })\r\n  }\r\n\r\n  _initializeFocusTrap() {\r\n    return new FocusTrap({\r\n      trapElement: this._element\r\n    })\r\n  }\r\n\r\n  _addEventListeners() {\r\n    EventHandler.on(this._element, EVENT_KEYDOWN_DISMISS, event => {\r\n      if (event.key !== ESCAPE_KEY) {\r\n        return\r\n      }\r\n\r\n      if (this._config.keyboard) {\r\n        this.hide()\r\n        return\r\n      }\r\n\r\n      EventHandler.trigger(this._element, EVENT_HIDE_PREVENTED)\r\n    })\r\n  }\r\n\r\n  // Static\r\n  static jQueryInterface(config) {\r\n    return this.each(function () {\r\n      const data = Offcanvas.getOrCreateInstance(this, config)\r\n\r\n      if (typeof config !== 'string') {\r\n        return\r\n      }\r\n\r\n      if (data[config] === undefined || config.startsWith('_') || config === 'constructor') {\r\n        throw new TypeError(`No method named \"${config}\"`)\r\n      }\r\n\r\n      data[config](this)\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * Data API implementation\r\n */\r\n\r\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DATA_TOGGLE, function (event) {\r\n  const target = SelectorEngine.getElementFromSelector(this)\r\n\r\n  if (['A', 'AREA'].includes(this.tagName)) {\r\n    event.preventDefault()\r\n  }\r\n\r\n  if (isDisabled(this)) {\r\n    return\r\n  }\r\n\r\n  EventHandler.one(target, EVENT_HIDDEN, () => {\r\n    // focus on trigger when it is closed\r\n    if (isVisible(this)) {\r\n      this.focus()\r\n    }\r\n  })\r\n\r\n  // avoid conflict when clicking a toggler of an offcanvas, while another is open\r\n  const alreadyOpen = SelectorEngine.findOne(OPEN_SELECTOR)\r\n  if (alreadyOpen && alreadyOpen !== target) {\r\n    Offcanvas.getInstance(alreadyOpen).hide()\r\n  }\r\n\r\n  const data = Offcanvas.getOrCreateInstance(target)\r\n  data.toggle(this)\r\n})\r\n\r\nEventHandler.on(window, EVENT_LOAD_DATA_API, () => {\r\n  for (const selector of SelectorEngine.find(OPEN_SELECTOR)) {\r\n    Offcanvas.getOrCreateInstance(selector).show()\r\n  }\r\n})\r\n\r\nEventHandler.on(window, EVENT_RESIZE, () => {\r\n  for (const element of SelectorEngine.find('[aria-modal][class*=show][class*=offcanvas-]')) {\r\n    if (getComputedStyle(element).position !== 'fixed') {\r\n      Offcanvas.getOrCreateInstance(element).hide()\r\n    }\r\n  }\r\n})\r\n\r\nenableDismissTrigger(Offcanvas)\r\n\r\n/**\r\n * jQuery\r\n */\r\n\r\ndefineJQueryPlugin(Offcanvas)\r\n\r\nexport default Offcanvas\r\n"],"names":["EVENT_KEY","EVENT_LOAD_DATA_API","EVENT_SHOW","EVENT_SHOWN","EVENT_HIDE","EVENT_HIDE_PREVENTED","EVENT_HIDDEN","EVENT_RESIZE","EVENT_CLICK_DATA_API","EVENT_KEYDOWN_DISMISS","Default","backdrop","keyboard","scroll","DefaultType","Offcanvas","BaseComponent","constructor","element","config","_isShown","_backdrop","this","_initializeBackDrop","_focustrap","_initializeFocusTrap","_addEventListeners","NAME","toggle","relatedTarget","hide","show","EventHandler","trigger","_element","defaultPrevented","_config","ScrollBarHelper","setAttribute","classList","add","_queueCallback","activate","remove","deactivate","blur","removeAttribute","reset","dispose","isVisible","Boolean","Backdrop","className","isAnimated","rootElement","parentNode","clickCallback","FocusTrap","trapElement","on","event","key","each","data","getOrCreateInstance","undefined","startsWith","TypeError","document","target","SelectorEngine","getElementFromSelector","includes","tagName","preventDefault","one","focus","alreadyOpen","findOne","getInstance","window","selector","find","getComputedStyle","position"],"mappings":"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"}